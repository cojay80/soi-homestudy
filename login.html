<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ë¡œê·¸ì¸ - ì†Œì´ì˜ ê³µë¶€ë°©</title>

  <!-- í°íŠ¸ / ê¸°ë³¸ ìŠ¤íƒ€ì¼ -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>

  <style>
    :root { --line:#e5e5e5; --muted:#666; --card:#fff; --bg:#f7f8fb; }
    * { box-sizing:border-box; }
    html, body { margin:0; padding:0; }
    body {
      font-family:'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif;
      background:var(--bg); color:#111;
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }
    .wrap { width:100%; max-width:440px; padding:20px; }
    .logo {
      display:flex; align-items:center; justify-content:flex-start; gap:8px; margin-bottom:12px;
    }
    .logo a { font-weight:800; font-size:22px; color:#111; text-decoration:none; }
    .card {
      background:var(--card); border:1px solid var(--line); border-radius:14px; padding:16px;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
    }
    .mini { color:var(--muted); font-size:13px; }
    .row { display:flex; align-items:center; gap:10px; }
    .row + .row { margin-top:10px; }
    label { font-size:14px; color:#333; }
    input[type=text] {
      flex:1; padding:12px; border:1px solid var(--line); border-radius:10px; background:#fff;
      font-size:16px;
    }
    .btn {
      padding:11px 14px; border:1px solid var(--line); border-radius:10px; background:#fafafa;
      cursor:pointer; transition:.15s;
    }
    .btn:hover { background:#f3f4f6; transform:translateY(-1px); }
    .btn-primary { background:#4f46e5; color:#fff; border-color:transparent; }
    .btn-primary:hover { background:#4338ca; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:12px; }
    footer { text-align:center; margin-top:14px; }
  </style>
</head>
<body>
  <main class="wrap" role="main">
    <!-- ì¢Œì¸¡ ê³ ì • ëŒ€ì œëª© ìŠ¤íƒ€ì¼ê³¼ í†¤ì„ ë§ì¶˜ ë¡œê³  -->
    <div class="logo">
      <a href="index.html" aria-label="ë©”ì¸ìœ¼ë¡œ">ì†Œì´ì˜ ê³µë¶€ë°© ğŸ¨</a>
    </div>

    <h1 style="font-size:20px; margin:0 0 4px;">ë¡œê·¸ì¸</h1>
    <p class="mini" style="margin:0 0 12px;">ì´ë¦„ì„ ì…ë ¥í•˜ê³  ì‹œì‘í•˜ì„¸ìš”.</p>

    <section class="card" aria-labelledby="login-title">
      <h2 id="login-title" class="mini" style="margin:0 0 8px;">ì‚¬ìš©ì ì •ë³´</h2>

      <div class="row" style="width:100%;">
        <label for="login-name">ì´ë¦„</label>
        <input
          id="login-name"
          type="text"
          placeholder="ì˜ˆ: ì†Œì´"
          inputmode="text"
          autocomplete="username"
          aria-label="ì‚¬ìš©ì ì´ë¦„"
          maxlength="20"
          required
        />
      </div>

      <div class="actions">
        <button id="btn-login" class="btn btn-primary">ì‹œì‘í•˜ê¸°</button>
        <a class="btn" href="index.html" aria-label="ë©”ì¸ìœ¼ë¡œ ì´ë™">ë©”ì¸ìœ¼ë¡œ</a>
      </div>

      <p class="mini" style="margin-top:10px;">* í•œê¸€/ì˜ë¬¸/ìˆ«ì/ê³µë°±ë§Œ í—ˆìš©, ìµœëŒ€ 20ì</p>
    </section>

    <footer class="mini">&copy; 2025 ì†Œì´ë¥¼ ìœ„í•œ ì•„ë¹ ì˜ ì„ ë¬¼</footer>
  </main>

  <script>
  (function(){
    const params = new URLSearchParams(location.search);
    const next = params.get('next') || 'index.html';
    const input = document.getElementById('login-name');
    const btn = document.getElementById('btn-login');

    // ì´ë¯¸ ë¡œê·¸ì¸ ìƒíƒœë©´ ë°”ë¡œ ì´ë™
    try {
      const u = (localStorage.getItem('currentUser') || '').trim();
      if (u) {
        location.replace(next);
        return;
      }
    } catch (_) {}

    // ìë™ í¬ì»¤ìŠ¤
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => input && input.focus(), { once:true });
    } else if (input) {
      input.focus();
    }

    // í—ˆìš© ë¬¸ì: í•œê¸€/ì˜ë¬¸/ìˆ«ì/ê³µë°±
    function normalizeName(raw){
      const cleaned = String(raw).replace(/[^0-9A-Za-zê°€-í£\s]/g, '');
      return cleaned.replace(/\s+/g, ' ').trim().slice(0, 20);
    }

    function ensureStudyDataFor(name){
      let sd = {};
      try { sd = JSON.parse(localStorage.getItem('studyData') || '{}') || {}; } catch {}
      if (!sd[name]) sd[name] = { incorrect: [], records: [] };
      localStorage.setItem('studyData', JSON.stringify(sd));
    }

    function saveAndGo(name){
      localStorage.setItem('currentUser', name);
      ensureStudyDataFor(name);
      window.dispatchEvent(new Event('user:changed')); // í—¤ë”/ë±ƒì§€ ë™ê¸°í™” ì‹ í˜¸
      location.href = next;
    }

    btn.addEventListener('click', () => {
      const norm = normalizeName(input.value);
      if (!norm) { alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); input.focus(); return; }
      saveAndGo(norm);
    });

    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        btn.click();
      }
    });
  })();
  </script>
</body>
</html>
