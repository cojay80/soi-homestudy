#1<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>소이의 공부방</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">

  <!-- 앱 공통 스크립트 (순서 중요: 설정/스토어/폴리필/시트) -->
  <script src="/js/config.js"></script>
  <script src="/js/core-auth-store.js?v=LS_PERSIST_1"></script>
  <script src="/js/api-shim.js"></script>
  <script src="/js/sheets.js"></script>
  <script src="/js/soi-store.js"></script>
<style>.soi-points-badge{padding:.2rem .5rem;border-radius:999px;border:1px solid #ddd;font-weight:600}</style>

  <!-- URL에 ?reset=1 이면 캐시/세션 정리 후 index로 복귀 -->
  <script>
    (function () {
      const qs = new URL(location.href).searchParams;
      if (qs.get('reset') === '1') {
        try {
          localStorage.removeItem('soi_name');
          localStorage.removeItem('selectedGrade');
          localStorage.removeItem('selectedSubject');
          localStorage.removeItem('selectedCount');
          localStorage.removeItem('selectedTimer');
        } catch {}
        (async () => {
          try {
            if (window.SoiStore && typeof window.SoiStore.currentUser === 'function') {
              const u = await window.SoiStore.currentUser();
              if (u && u.uid && typeof window.SoiStore.signOut === 'function') {
                await window.SoiStore.signOut();
              }
            }
          } catch {}
          location.replace('index.html');
        })();
      }
    })();
  </script>
</head>

<body>
  <!-- 로그인 화면 (기본 보임) -->
  <div id="login-container" style="display:flex;">
    <div class="login-box">
      <h1>소이의 공부방</h1>
      <p>사용자 이름을 입력해주세요.</p>
      <input type="text" id="username-input" placeholder="예) 소이" />
      <button id="login-button">시작하기</button>
    </div>
  </div>

  <!-- 메인 화면 (기본 숨김) -->
  <div id="main-container" style="display:none;">
    <header class="main-header">
      <div class="logo">
        <a href="index.html">소이의 공부방 🎨</a>
      </div>

      <nav class="main-nav">
        <ul>
          <li><a href="index.html">오늘의 학습</a></li>
          <li><a href="report.html">학습 보고서</a></li>
          <li><a href="goal.html">나의 목표</a></li>
          <li><a href="record.html">상세 기록</a></li>
          <li><a href="notes.html">오답 노트</a></li>
          <li><a href="shop.html">상점</a></li>
          <span class="soi-points-badge">포인트: <b data-soi-points>0</b>p</span>
        </ul>
      </nav>

      <div class="user-info">
        <span id="welcome-message"></span>
        <a href="index.html?reset=1" id="logout-button">(로그아웃)</a>
      </div>

      <button class="mobile-menu-button" aria-label="메뉴 열기/닫기">☰</button>
       </header>

    <!--
      ⚠️ 중요: 헤더 HTML 바로 뒤에 header.js를 로드해야
      햄버거 토글이 즉시 바인딩됩니다.
    -->
    <script src="js/header.js?v=HDR_MINIMAL_3"></script>

    <main>
      <!-- 홈 요약 -->
      <section style="padding:8px 0;">
        <div id="home-user" style="display:none;">
          <b>내 포인트:</b> <span id="pointsCount">-</span>
          &nbsp;/&nbsp;
          <b>보상 보유:</b> <span id="rewardsCount">-</span>
        </div>
      </section>

      <section class="goal-setting-section">
        <h2>이번 주 학습 목표 설정하기 🎯</h2>
        <div class="goal-box">
          <div id="current-goal-display" style="display:none;">
            <p><strong>이번 주 목표:</strong></p>
            <ul id="current-goal-list"></ul>
          </div>

          <div id="new-goal-form">
            <select id="goal-subject-select">
              <option value="">-- 과목 선택 --</option>
            </select>
            <input type="number" id="goal-count-input" placeholder="문제 수" min="1" />
            <button id="set-goal-button">목표 설정</button>
          </div>
        </div>
      </section>

      <section class="today-study-section">
        <div class="study-card">
          <div class="card-header">
            <h2>오늘의 학습 ✏️</h2>
          </div>

          <div class="card-content">
            <div class="selection-box">
              <label for="grade-select">학년 선택:</label>
              <select name="grades" id="grade-select">
                <option value="">-- 학년을 선택하세요 --</option>
              </select>
            </div>

            <div class="selection-box">
              <label for="subject-select">과목 선택:</label>
              <select name="subjects" id="subject-select">
                <option value="">-- 과목을 선택하세요 --</option>
              </select>
            </div>

            <div class="selection-box">
              <label for="count-select">문제 수 선택:</label>
              <select name="counts" id="count-select">
                <option value="10">10 문제</option>
                <option value="20">20 문제</option>
                <option value="30">30 문제</option>
              </select>
            </div>

            <div class="selection-box">
              <label for="timer-select">시간제한 (문제당):</label>
              <select name="timers" id="timer-select">
                <option value="0">무제한</option>
                <option value="10">10초</option>
                <option value="20">20초</option>
                <option value="30">30초</option>
                <option value="60">60초</option>
              </select>
            </div>
          </div>

          <div class="card-footer">
            <a href="quiz.html" class="start-button" id="start-button">학습 시작하기!</a>
          </div>
        </div>
      </section>
    </main>

    <footer class="main-footer">
      <p>&copy; 2025 소이를 위한 아빠의 선물</p>
    </footer>
  </div>

  <!-- 페이지 전용 스크립트: 메인 로직/강제 로그아웃 헬퍼 -->
  <script src="js/main.js?v=LOGIN_STRICT_3"></script>
  <script src="js/logout.js?v=LOGOUT_FORCE_2"></script>
</body>
</html>



