<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œì´ì˜ ê³µë¶€ë°©</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
<script src="/js/config.js"></script>
<script src="/js/core-auth-store.js"></script>
</head>
<body>

    <div id="login-container">
        <div class="login-box">
            <h1>ì†Œì´ì˜ ê³µë¶€ë°©</h1>
            <p>ì‚¬ìš©ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>
            <input type="text" id="username-input" placeholder="ì˜ˆ) ì†Œì´">
            <button id="login-button">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div id="main-container" style="display: none;">
        <header class="main-header">
    <div class="logo">
        <a href="index.html">ì†Œì´ì˜ ê³µë¶€ë°© ğŸ¨</a>
    </div>
    <nav class="main-nav">
        <ul>
            <li><a href="index.html">ì˜¤ëŠ˜ì˜ í•™ìŠµ</a></li>
            <li><a href="report.html">í•™ìŠµ ë³´ê³ ì„œ</a></li>
            <li><a href="goal.html">ë‚˜ì˜ ëª©í‘œ</a></li>
            <li><a href="record.html">ìƒì„¸ ê¸°ë¡</a></li>
            <li><a href="notes.html">ì˜¤ë‹µ ë…¸íŠ¸</a></li>
        </ul>
    </nav>
    <div class="user-info">
        <span id="welcome-message"></span>
        <a href="#" id="logout-button">(ë¡œê·¸ì•„ì›ƒ)</a>
    </div>
    <button class="mobile-menu-button">â˜°</button>
</header>
        
        <main>
            <section class="goal-setting-section">
                <h2>ì´ë²ˆ ì£¼ í•™ìŠµ ëª©í‘œ ì„¤ì •í•˜ê¸° ğŸ¯</h2>
                <div class="goal-box">
                    <div id="current-goal-display" style="display: none;">
                        <p><strong>ì´ë²ˆ ì£¼ ëª©í‘œ:</strong></p>
                        <ul id="current-goal-list">
                            </ul>
                    </div>
                    <div id="new-goal-form">
                        <select id="goal-subject-select">
                            <option value="">-- ê³¼ëª© ì„ íƒ --</option>
                        </select>
                        <input type="number" id="goal-count-input" placeholder="ë¬¸ì œ ìˆ˜" min="1">
                        <button id="set-goal-button">ëª©í‘œ ì„¤ì •</button>
                    </div>
                </div>
            </section>

            <section class="today-study-section">
                <div class="study-card">
                    <div class="card-header">
                        <h2>ì˜¤ëŠ˜ì˜ í•™ìŠµ âœï¸</h2>
                    </div>
                    <div class="card-content">
                        <div class="selection-box">
                            <label for="grade-select">í•™ë…„ ì„ íƒ:</label>
                            <select name="grades" id="grade-select">
                                <option value="">-- í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            </select>
                        </div>
                        <div class="selection-box">
                            <label for="subject-select">ê³¼ëª© ì„ íƒ:</label>
                            <select name="subjects" id="subject-select">
                                <option value="">-- ê³¼ëª©ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                            </select>
                        </div>
                        <div class="selection-box">
                            <label for="count-select">ë¬¸ì œ ìˆ˜ ì„ íƒ:</label>
                            <select name="counts" id="count-select">
                                <option value="10">10 ë¬¸ì œ</option>
                                <option value="20">20 ë¬¸ì œ</option>
                                <option value="30">30 ë¬¸ì œ</option>
                            </select>
                        </div>
                        <div class="selection-box">
                            <label for="timer-select">ì‹œê°„ì œí•œ (ë¬¸ì œë‹¹):</label>
                            <select name="timers" id="timer-select">
                                <option value="0">ë¬´ì œí•œ</option>
                                <option value="10">10ì´ˆ</option>
                                <option value="20">20ì´ˆ</option>
                                <option value="30">30ì´ˆ</option>
                                <option value="60">60ì´ˆ</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="#" class="start-button">í•™ìŠµ ì‹œì‘í•˜ê¸°!</a>
                    </div>
                </div>
            </section>
        </main>

        <footer class="main-footer">
            <p>&copy; 2025 ì†Œì´ë¥¼ ìœ„í•œ ì•„ë¹ ì˜ ì„ ë¬¼</p>
        </footer>
    </div>

    <script src="js/header.js"></script>
    <script src="js/main.js"></script>
<!-- í™ˆì—ì„œ ê°„ë‹¨íˆ ìƒíƒœ ë³´ì—¬ì¤„ ê³³ (ì›í•˜ë©´ ìˆ¨ê²¨ë„ ë¨) -->
<div id="home-user" style="padding:8px 0; display:none;">
  <b>ë‚´ í¬ì¸íŠ¸:</b> <span id="pointsCount">-</span> /
  <b>ë³´ìƒ ë³´ìœ :</b> <span id="rewardsCount">-</span>
</div>

<script>
(async function () {
  // ë¡œê·¸ì¸ í¼/ë©”ì¸ ì»¨í…Œì´ë„ˆ DOM
  const $login = document.getElementById('login-container');
  const $main  = document.getElementById('main-container');
  const $welcome = document.getElementById('welcome-message');
  const $logout = document.getElementById('logout-button');
  const $btnLogin = document.getElementById('login-button');
  const $nameInput = document.getElementById('username-input');

  const $status = document.getElementById('home-user');
  const $pts = document.getElementById('pointsCount');
  const $rwd = document.getElementById('rewardsCount');

  // 1) ë¡œê·¸ì¸(or ë¡œì»¬ í´ë°±) í™•ë³´
  const user = await (window.SoiStore.currentUser() || window.SoiStore.signIn("local@demo.com","local-demo"));
  const uid = user.uid;

  // 2) ì‚¬ìš©ì ë„íë¨¼íŠ¸ ì½ê¸°
  let doc = await window.SoiStore.getUserDoc(uid);
  if (!doc.rewards) doc.rewards = {};

  // 3) í™”ë©´ ë°˜ì˜ í•¨ìˆ˜
  function renderUser() {
    if ($welcome) $welcome.textContent = doc.name ? `${doc.name}ë‹˜ ë°˜ê°€ì›Œìš”!` : `í™˜ì˜í•©ë‹ˆë‹¤!`;
    if ($status)  $status.style.display = 'block';
    if ($pts)     $pts.textContent = String(doc.points ?? 0);
    if ($rwd) {
      const total = Object.values(doc.rewards || {}).reduce((a,b)=>a+(b||0), 0);
      $rwd.textContent = String(total);
    }
  }

  // 4) ë¡œê·¸ì¸ ìƒíƒœë¡œ ì „í™˜
  function gotoMain() { $login.style.display = 'none'; $main.style.display = 'block'; renderUser(); }
  function gotoLogin() { $main.style.display = 'none'; $login.style.display = 'block'; }

  if (doc.name && String(doc.name).trim()) {
    // ì´ë¦„ì´ ì´ë¯¸ ì €ì¥ë˜ì–´ ìˆìœ¼ë©´ ë°”ë¡œ ë©”ì¸ ì§„ì…
    gotoMain();
  } else {
    // ì´ë¦„ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ ë°•ìŠ¤ ë³´ì´ê¸°
    gotoLogin();
  }

  // 5) ë¡œê·¸ì¸ ë²„íŠ¼: ì´ë¦„ ì €ì¥ í›„ ë©”ì¸ìœ¼ë¡œ
  if ($btnLogin) {
    $btnLogin.addEventListener('click', async () => {
      const name = ($nameInput?.value || '').trim();
      if (!name) return alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      doc = await window.SoiStore.setUserDoc(uid, { ...doc, name });
      await window.SoiStore.pushLog(uid, { source: "í™ˆ", tier: "login", points: 0, action: "login", couponName: name });
      gotoMain();
    });
  }

  // 6) ë¡œê·¸ì•„ì›ƒ
  if ($logout) {
    $logout.addEventListener('click', async (e) => {
      e.preventDefault();
      await window.SoiStore.signOut();
      gotoLogin();
    });
  }

  // 7) â€œí•™ìŠµ ì‹œì‘í•˜ê¸°!â€ ë²„íŠ¼ì´ ìˆìœ¼ë©´ í€´ì¦ˆë¡œ ì´ë™(ì„ íƒ)
  const startBtn = document.querySelector('.start-button');
  if (startBtn) {
    startBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const grade = document.getElementById('grade-select')?.value || '';
      const subject = document.getElementById('subject-select')?.value || '';
      const count = document.getElementById('count-select')?.value || '10';
      const timer = document.getElementById('timer-select')?.value || '0';
      // ì„ íƒê°’ì„ ì¿¼ë¦¬ë¡œ ë„˜ê²¨ quiz.htmlì—ì„œ í™œìš©
      const qs = new URLSearchParams({ grade, subject, count, timer });
      location.href = `quiz.html?${qs.toString()}`;
    });
  }

  // 8) ì´ˆê¸° ë Œë” (ë©”ì¸ ìƒíƒœë¼ë©´ ìˆ«ì ê°±ì‹ )
  if ($main.style.display === 'block') renderUser();
})();
</script>

</body>

</html>

